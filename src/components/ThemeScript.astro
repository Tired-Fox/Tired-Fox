---
---
<script>
    const storageKey = 'TiredFox-Theme';
    type Theme = 'light' | 'dark';
    let theme: Theme = 'light';
    
    export function setTheme(new_theme: Theme) {
        theme = new_theme;
        saveTheme(theme);
        console.log(document.body, theme);
        document.body.setAttribute("data-theme", theme);
    }
    
    export function saveTheme(theme: Theme) {
        localStorage.setItem(storageKey, theme);
    }
    
    export function loadTheme(): Theme {
        return localStorage.getItem(storageKey) === 'dark' ? 'dark' : 'light';
    }
    
    export function toggleTheme() {
        if (theme === 'light') {
            setTheme('dark')
        } else {
            setTheme('light')
        }
    }
    
    export function toast(message: string, duration: number | undefined) {
        const container = document.getElementById('toasts');
        if (container) {
            const div = document.createElement('div');
            div.classList.add('toast');
    
            const deleteToast = () => {
                div.remove();
            };
    
            const close = document.createElement('button');
            close.innerText = 'x';
            close.onclick = () => {
                deleteToast();
            }
    
            const p = document.createElement('p');
            p.innerHTML = message;
    
            div.append(close);
            div.append(p);
            container.append(div);
    
            if (duration != null) {
                let finished = setInterval(
                    () => {
                        deleteToast()
                        clearInterval(finished)
                    },
                    duration
                );
            }
        }
    }

    window.onload = () => {
        setTheme(loadTheme());
        document.addEventListener("keydown", (event) => {
            if (event.altKey && event.key === 't') {
                console.log('Toggling Theme');
                setTheme(theme === 'light' ? 'dark' : 'light')
            }
        })

        let notify = setInterval(
            () => {
                toast('The color theme can be changed with <code>Alt + T</code>', 5000);
                clearInterval(notify)
            },
            1000
        );
    }
</script>